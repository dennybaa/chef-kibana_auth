# Generated by chef

start on filesystem
stop on runlevel [!2345]

expect fork
respawn
respawn limit 10 5

pre-start script
    test -d /var/log/kibana || { mkdir -p /var/log/kibana; }
    cd /var/log/kibana
    test -f rack.log || { touch rack.log; chown <%= @user %>:<%= @user %> rack.log; }
end script

# yeah we are using util, from runit package
script
  <% gemdir = ::File.dirname(Gem.bindir) -%>
  <% if ::File.exist?("#{gemdir}/environment") -%>
  . <%= "#{gemdir}/environment" %>
  <% end -%>
  cd <%= @rundir %>
  exec 1>>/var/log/kibana/rack.log
  exec 2>&1
  chpst -u <%= @user %> rackup -s <%= @webserver %> -o <%= @bind %> -p <%= @port %> config.ru
end script
